#include QMK_KEYBOARD_H
#include "raw_hid.h"

// --- HELPERS ---
#define _____ KC_NO
#define __v__ KC_TRNS
// --- END OF HELPERS ---

// --- LAYERS ---
#define _WORKMAN_LAYER 0
#define _QWERTY_LAYER  1
#define _SYMBOLS_LAYER 2
#define _TMUX_LAYER 3
#define _QTILE_LAYER 4
#define _MOVE_LAYER 5
#define _MOUSE_LAYER 6
#define _SYSTEM_LAYER 7
// --- END OF LAYERS ---

// --- TAP DANCES ---
enum {
    TD_1_F1,
    TD_2_F2,
    TD_3_F3,
    TD_4_F4,
    TD_5_F5,
    TD_6_F6,
    TD_7_F7,
    TD_8_F8,
    TD_9_F9,
    TD_0_F10,
};

qk_tap_dance_action_t tap_dance_actions[] = {
    [TD_1_F1]  = ACTION_TAP_DANCE_DOUBLE(KC_1, KC_F1),
    [TD_2_F2]  = ACTION_TAP_DANCE_DOUBLE(KC_2, KC_F2),
    [TD_3_F3]  = ACTION_TAP_DANCE_DOUBLE(KC_3, KC_F3),
    [TD_4_F4]  = ACTION_TAP_DANCE_DOUBLE(KC_4, KC_F4),
    [TD_5_F5]  = ACTION_TAP_DANCE_DOUBLE(KC_5, KC_F5),
    [TD_6_F6]  = ACTION_TAP_DANCE_DOUBLE(KC_6, KC_F6),
    [TD_7_F7]  = ACTION_TAP_DANCE_DOUBLE(KC_7, KC_F7),
    [TD_8_F8]  = ACTION_TAP_DANCE_DOUBLE(KC_8, KC_F8),
    [TD_9_F9]  = ACTION_TAP_DANCE_DOUBLE(KC_9, KC_F9),
    [TD_0_F10] = ACTION_TAP_DANCE_DOUBLE(KC_0, KC_F10),
};
// --- END OF TAP DANCES ---

// --- COMBOS ---
#if 0
enum combo_events {
    AS_COMBO
};

const uint16_t PROGMEM test_combo[] = { KC_A, KC_S, COMBO_END };

combo_t key_combos[1] = { 
    [AS_COMBO] = COMBO_ACTION(test_combo),
};

void process_combo_event(uint16_t combo_index, bool pressed) {
  switch(combo_index) {
    case AS_COMBO:
      if (pressed) {
        tap_code16(RALT(KC_A));
      }
      break;
  }
} 
#endif
// --- END OF COMBOS ---

// --- MACROS ---
enum custom_keycodes {
    _TMUX_A = SAFE_RANGE,
};

bool process_record_user(uint16_t keycode, keyrecord_t *record) {
    switch (keycode) {
    case _TMUX_A:
        if (record->event.pressed) {
            register_code(KC_LCTL);
            tap_code(KC_A);
            tap_code(KC_A);
            unregister_code(KC_LCTL);
        } else {
            // when keycode QMKBEST is released
        }
        break;
    }
    return true;
};
// --- END OF MACROS ---

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
	[_WORKMAN_LAYER] = LAYOUT_ortho_5x15(
        	// -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        	LT(_SYSTEM_LAYER, KC_ESC)        , /* | */ TD(TD_1_F1)   , TD(TD_2_F2)    ,  TD(TD_3_F3)   ,  TD(TD_4_F4) , TD(TD_5_F5)  , /* | */ _____, _____,  _____, /* | */ TD(TD_6_F6)           , TD(TD_7_F7)  , TD(TD_8_F8)   , TD(TD_9_F9)    , TD(TD_0_F10)     , /* | */ KC_BSPC     ,
        	// -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        	KC_TAB        , /* | */ KC_Q   , KC_D    , KC_R    , KC_W  , KC_B         , /* | */ _____, _____ , _____, /* | */ KC_J           , KC_F  , KC_U   , KC_P    , KC_SCLN  , /* | */ KC_QUOT     ,
        	LCTL_T(KC_ESC), /* | */ KC_A   , KC_S    , KC_H    , KC_T  , KC_G         , /* | */ _____, _____ , _____, /* | */ KC_Y           , KC_N  , KC_E   , KC_O    , KC_I     , /* | */ KC_ENT      ,
        	OSM(MOD_LSFT) , /* | */ KC_Z   , KC_X    , KC_M    , KC_C  , KC_V         , /* | */ _____, _____ , _____, /* | */ KC_K           , KC_L  , OSL(_SYMBOLS_LAYER) , KC_DOT  , KC_SLSH  , /* | */ KC_RSFT     ,
        	// -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
        	_____         , /* | */ KC_LGUI, KC_LALT , KC_BSPC , KC_SPC, TT(_TMUX_LAYER)      , /* | */ _____, _____ , _____, /* | */ TT(_MOVE_LAYER), RALT_T(KC_ENT), _____  , KC_RALT , KC_RGUI  , /* | */ TG(_SYMBOLS_LAYER))      ,
        	// -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

	[_QWERTY_LAYER] = LAYOUT_ortho_5x15(
        	// ---------------------------------------------------------------------------------------------------------------------------------------------------------------
        	__v__         , /* | */ __v__   , __v__    ,  __v__   ,  __v__ , __v__         , /* | */ __v__, __v__ , __v__, /* | */ __v__           , __v__  , __v__   , __v__    , __v__     , /* | */ __v__       ,
        	// ---------------------------------------------------------------------------------------------------------------------------------------------------------------
        	__v__         , /* | */ KC_Q    , KC_W     , KC_E     , KC_R   , KC_T          , /* | */ __v__, __v__ , __v__, /* | */ KC_Y            , KC_U   , KC_I    , KC_O     , KC_P      , /* | */ __v__       ,
        	__v__         , /* | */ KC_A    , KC_S     , KC_D     , KC_F   , KC_G          , /* | */ __v__, __v__ , __v__, /* | */ KC_H            , KC_J   , KC_K    , KC_L     , __v__     , /* | */ __v__       ,
        	__v__         , /* | */ KC_Z    , KC_X     , KC_C     , KC_V   , KC_B          , /* | */ __v__, __v__ , __v__, /* | */ KC_N            , KC_M   , __v__   , __v__    , __v__     , /* | */ __v__       ,
        	// ---------------------------------------------------------------------------------------------------------------------------------------------------------------
        	__v__         , /* | */ __v__   , __v__    , __v__    , __v__  , __v__         , /* | */ __v__, __v__ , __v__, /* | */ __v__           , __v__  , __v__   , __v__    , __v__     , /* | */ __v__)      ,
        	// ---------------------------------------------------------------------------------------------------------------------------------------------------------------

	[_MOVE_LAYER] = LAYOUT_ortho_5x15(
        	// ---------------------------------------------------------------------------------------------------------------------------------------------------------------
        	__v__         , /* | */ __v__   , __v__              ,  __v__   ,  __v__ , __v__         , /* | */ __v__, __v__ , __v__, /* | */ __v__                      , __v__    , __v__     , __v__       , __v__       , /* | */ __v__       ,
        	// ---------------------------------------------------------------------------------------------------------------------------------------------------------------
        	__v__         , /* | */ __v__   , __v__              , __v__    , __v__  , __v__         , /* | */ __v__, __v__ , __v__, /* | */ KC_INS                     , KC_HOME  , KC_UP     , KC_END      , KC_PGUP     , /* | */ __v__       ,
        	__v__         , /* | */ __v__   , __v__              , __v__    , __v__  , __v__         , /* | */ __v__, __v__ , __v__, /* | */ KC_DEL                     , KC_LEFT  , KC_DOWN   , KC_RIGHT    , KC_PGDN     , /* | */ __v__       ,
        	__v__         , /* | */ __v__   , __v__              , __v__    , __v__  , __v__         , /* | */ __v__, __v__ , __v__, /* | */ TG(_MOUSE_LAYER)           , __v__    , __v__     , __v__       , __v__       , /* | */ __v__       ,
        	// ---------------------------------------------------------------------------------------------------------------------------------------------------------------
        	__v__         , /* | */ __v__   , __v__              , __v__    , __v__  , __v__         , /* | */ __v__, __v__ , __v__, /* | */ __v__                      , __v__    , __v__     , __v__       , __v__       , /* | */ __v__)      ,
        	// ---------------------------------------------------------------------------------------------------------------------------------------------------------------

	[_MOUSE_LAYER] = LAYOUT_ortho_5x15(
        	// ---------------------------------------------------------------------------------------------------------------------------------------------------------------
        	__v__         , /* | */ __v__   , __v__    ,  __v__        ,  __v__      , __v__              , /* | */ __v__, __v__ , __v__, /* | */ __v__           , __v__       , __v__        , __v__          , __v__             , /* | */ KC_MS_ACCEL0       ,
        	// ---------------------------------------------------------------------------------------------------------------------------------------------------------------
        	__v__         , /* | */ __v__   , __v__    , __v__         , __v__       , __v__              , /* | */ __v__, __v__ , __v__, /* | */ __v__           , __v__       , KC_MS_UP     , KC_END         , KC_MS_WH_UP       , /* | */ KC_MS_ACCEL1       ,
        	__v__         , /* | */ __v__   , __v__    , __v__         , __v__       , __v__              , /* | */ __v__, __v__ , __v__, /* | */ __v__           , KC_MS_LEFT  , KC_MS_DOWN   , KC_MS_RIGHT    , KC_MS_WH_DOWN     , /* | */ KC_MS_ACCEL2       ,
        	__v__         , /* | */ __v__   , __v__    , __v__         , __v__       , __v__              , /* | */ __v__, __v__ , __v__, /* | */ __v__           , KC_MS_BTN1  , KC_MS_BTN3   , KC_MS_BTN2     , __v__             , /* | */ __v__              ,
        	// ---------------------------------------------------------------------------------------------------------------------------------------------------------------
        	__v__         , /* | */ __v__   , __v__    , __v__    , __v__  , __v__         , /* | */ __v__, __v__ , __v__, /* | */ __v__           , __v__       , __v__        , __v__          , __v__             , /* | */ __v__)             ,
        	// ---------------------------------------------------------------------------------------------------------------------------------------------------------------

	[_SYSTEM_LAYER] = LAYOUT_ortho_5x15(
        	// ---------------------------------------------------------------------------------------------------------------------------------------------------------------
        	__v__           , /* | */ RGB_TOG   , RGB_MOD     ,  RGB_HUI   ,  RGB_SAI  , RGB_VAI          , /* | */ __v__, __v__ , __v__, /* | */ __v__           , __v__  , __v__   , __v__    , __v__     , /* | */ RESET                    ,
        	// ---------------------------------------------------------------------------------------------------------------------------------------------------------------
        	__v__           , /* | */ __v__     , RGB_RMOD    , RGB_HUD    , RGB_SAD   , RGB_VAD          , /* | */ __v__, __v__ , __v__, /* | */ __v__           , __v__  , __v__   , __v__    , __v__     , /* | */ DEBUG                    ,
        	KC_ASUP         , /* | */ RGB_M_P   , RGB_M_B     , RGB_M_R    , RGB_M_SW  , RGB_M_SN         , /* | */ __v__, __v__ , __v__, /* | */ __v__           , __v__  , __v__   , __v__    , __v__     , /* | */ __v__                    ,
                KC_ASDN         , /* | */ RGB_M_K   , RGB_M_X     , RGB_M_G    , RGB_M_T   , __v__            , /* | */ __v__, __v__ , __v__, /* | */ __v__           , __v__  , __v__   , __v__    , __v__     , /* | */ DF(_WORKMAN_LAYER)       ,
        	// ---------------------------------------------------------------------------------------------------------------------------------------------------------------
        	KC_ASTG         , /* | */ KC_ASOFF   , KC_ASON     , __v__      , __v__     , __v__            , /* | */ __v__, __v__ , __v__, /* | */ __v__           , __v__  , __v__   , __v__    , __v__     , /* | */ DF(_QWERTY_LAYER))       ,
        	// ---------------------------------------------------------------------------------------------------------------------------------------------------------------

	[_SYMBOLS_LAYER] = LAYOUT_ortho_5x15(
        	// ---------------------------------------------------------------------------------------------------------------------------------------------------------------
        	__v__         , /* | */ __v__     , __v__      ,  __v__       ,  __v__     , __v__              , /* | */ __v__, __v__ , __v__, /* | */ __v__                , __v__    , __v__     , __v__                 , __v__          , /* | */ __v__       ,
        	// ---------------------------------------------------------------------------------------------------------------------------------------------------------------
        	__v__         , /* | */ S(KC_5)   , S(KC_7)    , S(KC_EQL)    , S(KC_2)    , S(KC_4)            , /* | */ __v__, __v__ , __v__, /* | */ KC_SLSH              , KC_LBRC  , KC_RBRC   , S(KC_1)               , S(KC_QUOT)     , /* | */ __v__       ,
        	__v__         , /* | */ S(KC_MINS), S(KC_9)    , KC_EQL       , KC_0       , S(KC_LBRC)         , /* | */ __v__, __v__ , __v__, /* | */ S(KC_RBRC)           , KC_1     , S(KC_8)   , S(KC_0)               , KC_MINS        , /* | */ __v__       ,
        	__v__         , /* | */ KC_6      , KC_7       , KC_8         , KC_9       , S(KC_BSLS)         , /* | */ __v__, __v__ , __v__, /* | */ KC_BSLS              , KC_2     , KC_3      , KC_4                  , KC_5           , /* | */ __v__       ,
        	// ---------------------------------------------------------------------------------------------------------------------------------------------------------------
        	__v__         , /* | */ __v__     , S(KC_GRV)  , S(KC_6)      , __v__      , KC_GRV             , /* | */ __v__, __v__ , __v__, /* | */ S(KC_3)              , KC_COMM  , S(KC_COMM)   , __v__    , __v__          , /* | */ __v__)      ,
        	// ---------------------------------------------------------------------------------------------------------------------------------------------------------------

    	[_TMUX_LAYER] = LAYOUT_ortho_5x15(
        	// ---------------------------------------------------------------------------------------------------------------------------------------------------------------
        	__v__         , /* | */ __v__   , __v__    ,  __v__   ,  __v__ , __v__         , /* | */ __v__, __v__ , __v__, /* | */ __v__           , __v__  , __v__   , __v__    , __v__     , /* | */ __v__       ,
        	// ---------------------------------------------------------------------------------------------------------------------------------------------------------------
        	__v__         , /* | */ __v__   , __v__    , __v__    , __v__  , __v__         , /* | */ __v__, __v__ , __v__, /* | */ __v__           , __v__  , __v__   , __v__    , __v__     , /* | */ __v__       ,
        	__v__         , /* | */ __v__   , __v__    , __v__    , _TMUX_A  , __v__         , /* | */ __v__, __v__ , __v__, /* | */ __v__           , __v__  , __v__   , __v__    , __v__     , /* | */ __v__       ,
        	__v__         , /* | */ __v__   , __v__    , __v__    , __v__  , __v__         , /* | */ __v__, __v__ , __v__, /* | */ __v__           , __v__  , __v__   , __v__    , __v__     , /* | */ __v__       ,
        	// ---------------------------------------------------------------------------------------------------------------------------------------------------------------
        	__v__         , /* | */ __v__   , __v__    , __v__    , __v__  , __v__         , /* | */ __v__, __v__ , __v__, /* | */ __v__           , __v__  , __v__   , __v__    , __v__     , /* | */ __v__)      ,
        	// ---------------------------------------------------------------------------------------------------------------------------------------------------------------

#if 0
	[_EMPTY_LAYER] = LAYOUT_ortho_5x15(
	// ---------------------------------------------------------------------------------------------------------------------------------------------------------------
	__v__         , /* | */ __v__   , __v__    ,  __v__   ,  __v__ , __v__         , /* | */ __v__, __v__ , __v__, /* | */ __v__           , __v__  , __v__   , __v__    , __v__     , /* | */ __v__       ,
	// ---------------------------------------------------------------------------------------------------------------------------------------------------------------
	__v__         , /* | */ __v__   , __v__    , __v__    , __v__  , __v__         , /* | */ __v__, __v__ , __v__, /* | */ __v__           , __v__  , __v__   , __v__    , __v__     , /* | */ __v__       ,
	__v__         , /* | */ __v__   , __v__    , __v__    , __v__  , __v__         , /* | */ __v__, __v__ , __v__, /* | */ __v__           , __v__  , __v__   , __v__    , __v__     , /* | */ __v__       ,
	__v__         , /* | */ __v__   , __v__    , __v__    , __v__  , __v__         , /* | */ __v__, __v__ , __v__, /* | */ __v__           , __v__  , __v__   , __v__    , __v__     , /* | */ __v__       ,
	// ---------------------------------------------------------------------------------------------------------------------------------------------------------------
	__v__         , /* | */ __v__   , __v__    , __v__    , __v__  , __v__         , /* | */ __v__, __v__ , __v__, /* | */ __v__           , __v__  , __v__   , __v__    , __v__     , /* | */ __v__)      ,
	// ---------------------------------------------------------------------------------------------------------------------------------------------------------------
#endif
};

void raw_hid_receive(uint8_t *data, uint8_t length) {
        raw_hid_send(data, length);
}

bool _reenable_as;

uint32_t layer_state_set_user(uint32_t state) {
    switch (biton32(state)) {
      case _SYMBOLS_LAYER:
          _reenable_as = get_autoshift_state();
          autoshift_disable();
          break;
      default:
          if (_reenable_as) {
              _reenable_as = false;
              autoshift_enable();
          }
          break;
      }
   return state;
}

